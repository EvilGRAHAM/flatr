{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Cumulative Logit Models for Multi-Ordinal Responses\"\nauthor: \"Scott Graham\"\ndate: \"November 08, 2017\"\noutput:\n  ioslides_presentation:\n    smaller: true\n---\n\\[\n  \\newcommand{\\Prob}{\\operatorname{P}}\n  \\newcommand{\\E}{\\operatorname{E}}\n  \\newcommand{\\Var}{\\operatorname{Var}}\n  \\newcommand{\\Cov}{\\operatorname{Cov}}\n  \\newcommand{\\se}{\\operatorname{se}}\n  \\newcommand{\\re}{\\operatorname{re}}\n  \\newcommand{\\ybar}{{\\overline{Y}}}\n  \\newcommand{\\phat}{{\\hat{p}}}\n  \\newcommand{\\that}{{\\hat{T}}}\n  \\newcommand{\\med}{{\\tilde{Y}}}\n  \\newcommand{\\Logit}{{\\operatorname{Logit}}}\n  \\]\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nlibrary(MASS, warn.conflicts = FALSE, quietly = TRUE)\nlibrary(ordinal, warn.conflicts = FALSE, quietly = TRUE)\nlibrary(knitr, warn.conflicts = FALSE, quietly = TRUE)\nlibrary(kableExtra, warn.conflicts = FALSE, quietly = TRUE)\nlibrary(flatr, warn.conflicts = FALSE, quietly = TRUE)\nlibrary(tidyverse, warn.conflicts = FALSE, quietly = TRUE)\nlibrary(magrittr, warn.conflicts = FALSE, quietly = TRUE)\n\ntheme_minimal2 <- theme_minimal() %>%  theme_set()\ntheme_minimal2 <-\n  theme_update(\n    panel.border = element_rect(\n      linetype = \"solid\"\n      ,colour = \"grey92\"\n      ,fill = NA\n    )\n    ,strip.background = element_rect(\n      linetype = \"solid\"\n      ,colour = \"grey92\"\n      ,fill = NA\n    )\n  )\npol_ct <- \n  array(\n    data = \n      c(\n        44, 18\n        ,47, 28\n        ,118, 86\n        ,23, 39\n        ,32, 48\n        ,36, 12\n        ,34, 18\n        ,53, 62\n        ,18, 45\n        ,23, 51\n      )\n    ,dim = c(2, 5, 2)\n    ,dimnames = list(\n      Party = c(\"Democrat\", \"Republican\")\n      ,Ideology = c(\"VL\", \"SL\", \"M\", \"SC\", \"VC\")\n      ,Gender = c(\"F\", \"M\")\n    )\n  )\n\npol_tidy <- flatten_ct(pol_ct)\npol_tidy$Ideology <- \n  factor(\n    x = pol_tidy$Ideology\n    ,levels = levels(pol_tidy$Ideology)[c(5, 3, 1, 2, 4)]\n    ,ordered = TRUE\n  )\n```\n\n# Theory\n## Data\n- $Y_{i}$ is Ordinal\n$$\n  Y_{i} = 1, 2, \\dots, J\n$$\n- Ex: Likert Scale\n$$\n  Y_{i} =\n  \\begin{cases}\n    1,\\text{ if Strongly Disagree}          \\\\\n    2,\\text{ if Disagree}                   \\\\\n    3,\\text{ if Neither Agree or Disagree}  \\\\\n    4,\\text{ if Agree}                      \\\\\n    5,\\text{ if Strongly Agree}             \n  \\end{cases}\n$$\n\n\n## Cumulative Logit\n- Recall:\n$$\n  \\Prob\\left( Y \\leq j \\right) =\n  \\sum_{i=1}^{j}\\pi_{i}\n$$\n- Let:\n$$\n  L_{j} =\n  \\Logit\\left[ \\Prob\\left( Y \\leq j \\right) \\right] =\n  \\ln\\left[ \\frac{\\Prob\\left( Y \\leq j \\right)}{1 - \\Prob\\left( Y \\leq j \\right)} \\right] =\n  \\ln\\left[ \\frac{\\sum_{i=1}^{j}\\pi_{i}}{\\sum_{i=j+1}^{J}\\pi_{i}} \\right]\n$$\n- Where:\n$$\n  j = 1, 2, \\dots J-1\n$$\n\n\n## Cumulative Logit Model\n- We can consider $J-1$ logistic regressions, each measuring the log odds of $Y_{i} \\leq j$ vs. $Y_{i} > j$\n$$\n  L_{j} = \\beta_{j,0} + \\sum_{i=1}^{p}\\beta_{j,i}X_{i}\n$$\n- Ex:\n$$\n  L_{1} = \\beta_{1,0} + \\sum_{i=1}^{p}\\beta_{1,i}X_{i}\n$$\n$$\n  L_{2} = \\beta_{2,0} + \\sum_{i=1}^{p}\\beta_{2,i}X_{i}\n$$\n$$\n  \\vdots\n$$\n$$\n  L_{J-1} = \\beta_{J-1,0} + \\sum_{i=1}^{p}\\beta_{J-1,i}X_{i}\n$$\n\n\n## Proportional-Odds\n- However because all the $\\beta_{j,i}$'s differ, we can't make a comparison to the baseline model!\n$$\n  L_{j} =\n  \\alpha_{j} - \\left( \\sum_{i=1}^{p}\\beta_{i}X_{i} \\right),\n  \\forall j = 1,2,\\dots, J-1\n$$\n\n- Hold the $\\beta_{i}$'s constant and only vary $\\alpha_{j}$\n- Note:\n$$\n  L_{1} \\leq\n  L_{2} \\leq\n  \\dots \\leq\n  L_{J-1}\n$$\n\n\n## Probability\n- Rearranging:\n$$\n  \\Prob\\left( Y \\leq j \\middle| X_{i} = x_{i}, \\forall i = 1, \\dots, p \\right) =\n  \\frac{e^{\\alpha_{j} - \\left( \\sum_{i=1}^{p}\\beta_{i}X_{i}\\right)}}{1 + e^{\\alpha_{j} - \\left( \\sum_{i=1}^{p}\\beta_{i}X_{i}\\right)}}\n$$\n$$\n  \\implies\n  \\Prob\\left( Y = j \\right) =\n  \\Prob\\left( Y \\leq j \\right) - \\Prob\\left( Y \\leq j-1 \\right) =\n  \\Prob\\left( Y > j-1 \\right) - \\Prob\\left( Y > j \\right)\n$$\n$$\n  =\n  \\frac{1}{1 + e^{\\alpha_{j} - \\left( \\sum_{i=1}^{p}\\beta_{i}X_{i}\\right)}} - \\frac{1}{1 + e^{\\alpha_{j} - \\left( \\sum_{i=1}^{p}\\beta_{i}X_{i}\\right)}}\n$$\n\n\n\n# Example\n## Ideology by Gender and Political Party\n```{r Data, echo = FALSE, results = \"asis\"}\npol_tidy %>% \n  head() %>% \n  kable()\n```\n\n$$\n  VL < SL < M < SC < VC\n$$\n$$\n  \\implies J = 5\n$$\n\n\n## Regression\n```{r Regression, echo = FALSE}\nideology_logit_1 <- \n  MASS::polr(\n    Ideology ~ Party\n    ,data = pol_tidy\n  )\nsummary(ideology_logit_1)\n```\n\n\n## Coefficients\n$$\n  \\alpha_{1} = -1.4944\n$$\n$$\n  \\alpha_{2} = -0.5000\n$$\n$$\n  \\alpha_{3} = 1.2116\n$$\n$$\n  \\alpha_{4} = 2.0441\n$$\n$$\n  \\beta = 0.9745\n$$\n$$\n  X =\n  \\begin{cases}\n    0,\\text{ if Democrat}   \\\\\n    1,\\text{ if Republican}\n  \\end{cases}\n$$\n- For a fixed $j$, the estimated log odds in favour of being more conservative than more liberal is `r round(ideology_logit_1$coefficients, 4)` greater for a Republican vs. a Democrat.\n\n## \n```{r Plot1, echo = FALSE}\npol_pred <- \n  ideology_logit_1 %>% \n  predict(\n    newdata = data.frame(Party = c(\"Democrat\", \"Republican\"))\n    ,type = \"probs\"\n  ) %>%\n  t() %>% \n  as.data.frame() %>% \n  rownames_to_column() %>% \n  as.tibble()\n\ncolnames(pol_pred) <- c(\"Ideology\", \"Democrat\", \"Republican\")\n\npol_pred <-\n  pol_pred %>% \n  gather(key = Party, value = Probability, - Ideology) %>% \n  mutate(\n    Ideology = as.factor(Ideology)\n    ,Party = as.factor(Party)\n  ) %>% \n  group_by(Party) %>% \n  mutate(\n    `Cumulative Probability` = cumsum(Probability)\n    ,Odds = `Cumulative Probability` / (1 - `Cumulative Probability`)\n    ,`Log Odds` = log(Odds)\n  )\n\npol_pred$Ideology <- \n  factor(\n    x = pol_pred$Ideology\n    ,levels = levels(pol_pred$Ideology)[c(5, 3, 1, 2, 4)]\n    ,ordered = TRUE\n  )\n\npol_pred %>% \n  ggplot(\n    aes(\n      x = Ideology\n      ,y = Probability\n      ,colour = Party\n      ,group = Party\n    )\n  ) +\n  geom_line(size = 1) +\n  scale_colour_brewer(\n    type = \"qual\"\n    ,name = \"Party:\"\n    ,palette = \"Set2\"\n  ) + \n  labs(title = \"P(Y = j)\")\n```\n\n\n##\n```{r Plot2, echo = FALSE}\npol_pred %>% \n  ggplot(\n    aes(\n      x = Ideology\n      ,y = `Cumulative Probability`\n      ,colour = Party\n      ,group = Party\n    )\n  ) +\n  geom_line(size = 1) +\n  scale_colour_brewer(\n    type = \"qual\"\n    ,name = \"Party:\"\n    ,palette = \"Set2\"\n  ) + \n  labs(title = \"P(Y <= j)\")\n```\n\n\n##\n```{r Plot3, echo = FALSE}\npol_pred %>% \n  ggplot(\n    aes(\n      x = Party\n      ,y = `Log Odds`\n      ,colour = Ideology\n      ,group = Ideology\n    )\n  ) +\n  geom_line(size = 1) +\n  scale_colour_brewer(\n    type = \"qual\"\n    ,name = \"Ideology:\"\n    ,palette = \"Set2\"\n  ) + \n  labs(title = expression(ln(frac(\"P(Y<=j)\",\"P(Y>j)\"))))\n```\n\n# References\n##\n- Agresti, A. (2007). An Introduction to Categorical Data Analysis. Hoboken, NJ: Wiley-Interscience.\n- 8.4 - The Proportional-Odds Cumulative Logit Model. (n.d.). Retrieved November 07, 2017, from https://onlinecourses.science.psu.edu/stat504/node/176",
    "created" : 1510597619220.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "363229939",
    "id" : "482EB613",
    "lastKnownWriteTime" : 1510182644,
    "last_content_update" : 1510597997929,
    "path" : "~/GitHub/grahamStat/projects/STAT_541/Cumulative_Logit_Models_for_Multi-Ordinal_Responses/index.Rmd",
    "project_path" : null,
    "properties" : {
        "last_setup_crc32" : ""
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}